package db

import (
	"database/sql"
	"expdb/models"
	"fmt"

	_ "github.com/lib/pq"
)

var expDatabaseInfo = PostgresDB{
	Host:     "localhost",
	Port:     5432,
	Name:     "exploitdb",
	Username: "postgres",
	Password: "admin",
	Ssl:      "disable",
}

func InitExploitDB() (*sql.DB, error) {
	expDB, err := expDatabaseInfo.init()
	if err != nil {
		return nil, err
	}
	err = createExploitTable(expDB)
	return expDB, err
}

func InsertExploit(db *sql.DB, exploit models.Exploit) error {
	columns := fmt.Sprintf(`%s, %s, %s, %s`, "date", "title", "type", "platform")
	values := fmt.Sprintf(`'%s', '%s', '%s', '%s'`, exploit.Date, exploit.Title, exploit.Type, exploit.Platform)
	err := insertRow(db, "exploits", columns, values)
	return err
}

func createExploitTable(db *sql.DB) error {
	statement := `
	CREATE TABLE IF NOT EXISTS exploits (
	date VARCHAR(12),
	title TEXT,
	type VARCHAR(255),
	platform VARCHAR(255))`
	_, err := db.Exec(statement)
	return err
}

func ResetExploitDB() error {
	err := expDatabaseInfo.reset()
	return err
}
