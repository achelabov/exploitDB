package db

import (
	"database/sql"

	_ "github.com/lib/pq"
)

func InitExploitDB() (*sql.DB, error) {
	expDatabaseInfo := PostgresDB{
		Host:     "localhost",
		Port:     5432,
		Name:     "ExploitDB",
		Username: "postgres",
		Password: "admin",
		Ssl:      "disable",
	}
	expDB, err := expDatabaseInfo.Init()
	if err != nil {
		return nil, err
	}
	err = createExploitTable(expDB)
	if err != nil {
		return nil, err
	}
	return expDB, nil
}

func createExploitTable(db *sql.DB) error {
	statement := `CREATE TABLE IF NOT EXISTS exploits (
	date DATE NOT NULL DEFAULT CURRENT_DATE,
	title TEXT,
	type TEXT,
	platform TEXT
	)`
	_, err := db.Exec(statement)
	return err
}
